<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Methods and Plots • pagoo</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Methods and Plots">
<meta property="og:description" content="pagoo">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-164668935-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-164668935-1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">pagoo</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.4.9004</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/pagoo.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Input.html">1 - Input</a>
    </li>
    <li>
      <a href="../articles/Querying_Data.html">2 - Querying Data</a>
    </li>
    <li>
      <a href="../articles/Subseting.html">3 - Subseting</a>
    </li>
    <li>
      <a href="../articles/Methods_Plots.html">4 - Methods and Plots</a>
    </li>
    <li>
      <a href="../articles/Recipes.html">5 - Recipes</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/iferres/pagoo/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="Methods_Plots_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Methods and Plots</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/iferres/pagoo/blob/master/vignettes/Methods_Plots.Rmd"><code>vignettes/Methods_Plots.Rmd</code></a></small>
      <div class="hidden name"><code>Methods_Plots.Rmd</code></div>

    </div>

    
    
<p>We implemented <code>pagoo</code> to provide basic but fundamental statistical analyses and visualizations out-of-the-box. Some of them are just wrappers of other packages functions (see <code>vegan</code> and <code>micropan</code> R packages; cite them also if you use <code>pagoo</code>), and graphics are made by <code>ggplot2</code> and <code>plotly</code> packages. All these are very useful for initial data exploration, but also provide a lot of flexibility to interact with other R packages in order to make more complex plots and more robust analyses. Also an interactive <code>Shiny App</code> can be easily deployed with a single funtion call, useful specially for those users that not very used to work with R code and prefer a UI, but also powerful for experienced users since it gives a general view of the data.</p>
<p>All this methods are embebbed to the <code>pagoo</code> object, so is very easy to start working with pangenome data.</p>
<p>Start by loading the example dataset.</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://iferres.github.io/pagoo">pagoo</a></span>) <span class="co"># Load package</span>
<span class="kw">toy_rds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">'extdata'</span>, <span class="st">'campylobacter.RDS'</span>, package = <span class="st">'pagoo'</span>)
<span class="kw">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_pangenomeRDS.html">load_pangenomeRDS</a></span>(<span class="kw">toy_rds</span>)
</pre></div>
<p>As you may have already noted, methods and visualization are different than data fields (see previous tutorials) in the way of calling them. As any R function, you must use parentheses to run them.</p>
<div id="statistical-methods" class="section level1">
<h1 class="hasAnchor">
<a href="#statistical-methods" class="anchor"></a>Statistical methods</h1>
<p>In this tutorial some, but not all, methods will be covered. Once you get the idea, just browse the documentation to see other available methods and what arguments they take.</p>
<div id="gene-abundance-distance" class="section level2">
<h2 class="hasAnchor">
<a href="#gene-abundance-distance" class="anchor"></a>Gene Abundance Distance</h2>
<p>Pairwise distances between gene abundance can be retieved by using <code>$dist()</code> method. By default, Bray-Curtis distance is computed. This is just a wrapper of <code>vegdist()</code> from <code>vegan</code> package.</p>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="kw">p</span><span class="op">$</span><span class="fu"><a href="https://rdrr.io/r/stats/dist.html">dist</a></span>()
</pre></div>
<pre><code>##              16244_6_6  16244_6_18  16244_6_24  16244_6_31  17059_2_16
## 16244_6_18 0.065946561                                                
## 16244_6_24 0.020662327 0.052783386                                    
## 16244_6_31 0.020650636 0.052752955 0.006314581                        
## 17059_2_16 0.121228163 0.125000000 0.112422860 0.110753553            
## 17059_2_23 0.096227447 0.096325167 0.085112282 0.085065115 0.076323988
## 17059_2_27 0.092459366 0.113100081 0.100486224 0.099892009 0.103116291
## 17150_1_73 0.082039911 0.090344438 0.071127355 0.070525428 0.136244082
## 17059_2_11 0.023769100 0.053633218 0.007751938 0.008321377 0.114270386
## 17059_2_42 0.089207048 0.099270892 0.076794192 0.077309517 0.145321485
##             17059_2_23  17059_2_27  17150_1_73  17059_2_11
## 16244_6_18                                                
## 16244_6_24                                                
## 16244_6_31                                                
## 17059_2_16                                                
## 17059_2_23                                                
## 17059_2_27 0.082309903                                    
## 17150_1_73 0.122759370 0.129997352                        
## 17059_2_11 0.084257206 0.100729139 0.073074761            
## 17059_2_42 0.126821371 0.137069192 0.095185996 0.076493579</code></pre>
<p>Other distances available include, for instance, Jaccard distance (see documentation). As this method require presence/absence data, and not abundance, you should use it with <code>binary = TRUE</code> argument set.</p>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="kw">p</span><span class="op">$</span><span class="fu"><a href="https://rdrr.io/r/stats/dist.html">dist</a></span>(method = <span class="st">"jaccard"</span>, binary = <span class="fl">TRUE</span>)
</pre></div>
<!-- ## Rarefaction -->
<!-- A rarefaction or permutation sampling method is available. By default, it performs 10 permutations sampling from 1 to nth genomes, and getting the resulting number of clusters for each pangenome.  -->
<!-- ```{r} -->
<!-- p$rarefact() -->
<!-- ``` -->
<!-- You can also "rarefact" the coregenome. -->
<!-- ```{r, eval=FALSE} -->
<!-- p$rarefact(what = "coregenome") -->
<!-- ``` -->
<!-- ## Pangenome Power Law Fit -->
<!-- Using the above `$rarefact()` method, a Power Law function can be fitted. -->
<!-- ```{r} -->
<!-- pow_law <- p$pg_power_law_fit()$formula -->
<!-- ``` -->
<!-- ## Coregenome Exponential Decay Fit -->
<!-- ```{r} -->
<!-- ``` -->
</div>
<div id="principal-component-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#principal-component-analysis" class="anchor"></a>Principal Component Analysis</h2>
<p>A method to compute <code>prcomp</code> (<code>stats</code> package) over the panmatrix is provided. You can use generic functions to further analyze the results.</p>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="kw">pca</span> <span class="op">&lt;-</span> <span class="kw">p</span><span class="op">$</span><span class="fu">pan_pca</span>()
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="kw">pca</span>)
</pre></div>
<pre><code>## Importance of components:
##                           PC1    PC2    PC3    PC4    PC5     PC6     PC7
## Standard deviation     7.2247 5.3474 4.7343 4.4424 4.0904 3.73292 2.25443
## Proportion of Variance 0.3231 0.1770 0.1388 0.1222 0.1036 0.08627 0.03147
## Cumulative Proportion  0.3231 0.5002 0.6390 0.7611 0.8647 0.95099 0.98245
##                            PC8     PC9      PC10
## Standard deviation     1.27427 1.10023 1.531e-14
## Proportion of Variance 0.01005 0.00749 0.000e+00
## Cumulative Proportion  0.99251 1.00000 1.000e+00</code></pre>
</div>
</div>
<div id="visualization-methods" class="section level1">
<h1 class="hasAnchor">
<a href="#visualization-methods" class="anchor"></a>Visualization methods</h1>
<p><code>pagoo</code> uses <code>ggplot2</code> package to produce customizable visualizations. While is not necessary to load <code>ggplot2</code> to plot pangenome data, is better since you can fully customize them. Also we will be using <code>patchwork</code> to arrange plots in some cases to show, side by side, the default plot and a customized one.</p>
<div class="sourceCode" id="cb7"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="http://ggplot2.tidyverse.org">ggplot2</a></span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://patchwork.data-imaginist.com">patchwork</a></span>) <span class="co"># To arrange plots</span>
</pre></div>
<div id="summary-pie-chart" class="section level2">
<h2 class="hasAnchor">
<a href="#summary-pie-chart" class="anchor"></a>Summary Pie Chart</h2>
<p>The most basic plot is a pie chart to show core, shell, and cloud genome proportions.</p>
<div class="sourceCode" id="cb8"><pre class="downlit">
<span class="co"># Basic</span>
<span class="kw">pie1</span> <span class="op">&lt;-</span> <span class="kw">p</span><span class="op">$</span><span class="fu">gg_pie</span>() <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">"Default"</span>)

<span class="co"># Customize with ggplot2</span>
<span class="kw">pie2</span> <span class="op">&lt;-</span> <span class="kw">pie1</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">"Customized"</span>) <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>(base_size = <span class="fl">15</span>) <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_brewer</a></span>(palette = <span class="st">"Blues"</span>)

<span class="co"># Arrange (patchwork) and plot</span>
<span class="kw">pie1</span> <span class="op">+</span> <span class="kw">pie2</span>
</pre></div>
<p><img src="Methods_Plots_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
</div>
<div id="gene-frequency-barplot" class="section level2">
<h2 class="hasAnchor">
<a href="#gene-frequency-barplot" class="anchor"></a>Gene Frequency BarPlot</h2>
<p>Frequency barplots are one of the basic plots in pangenomics. They show how many clusters are in only 1 genome, how many in 2 genomes, ..and so on, until showing how many clusters are in all genomes (i.e. they are part of the coregenome).</p>
<div class="sourceCode" id="cb9"><pre class="downlit">
<span class="kw">p</span><span class="op">$</span><span class="fu">gg_barplot</span>()
</pre></div>
<p><img src="Methods_Plots_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<!-- ## Distance HeatMap -->
<!-- ```{r} -->
<!-- p$gg_dist() -->
<!-- ``` -->
</div>
<div id="gene-presenceabsence-binmap" class="section level2">
<h2 class="hasAnchor">
<a href="#gene-presenceabsence-binmap" class="anchor"></a>Gene Presence/Absence BinMap</h2>
<p>A binary map show gene presence/absence patterns per genome. Each column is a cluster of orthologous genes, and each row an organism. The columns (clusters) are sorted by column sums, so core genes appear to the left, cloud genes to the right, and shell genes in the middle. This plot is useful, for example, to identify strains with abnormal accessory gene patterns which can represent true biological signatures like the presence of extrachromosomal elements or artifacts product of contamination during sequencing.</p>
<div class="sourceCode" id="cb10"><pre class="downlit">
<span class="kw">p</span><span class="op">$</span><span class="fu">gg_binmap</span>()
</pre></div>
<p><img src="Methods_Plots_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
</div>
<div id="rarefaction-curves" class="section level2">
<h2 class="hasAnchor">
<a href="#rarefaction-curves" class="anchor"></a>Rarefaction Curves</h2>
<p>Pangenome curves typically illustrate the number of gene clusters that are subsequently discovered as more genomes are added to the dataset. If the pangenome is open, more and more accessory genes will be discovered as new genomes are added to the analysis and the size of the core genome will tend to decrease. <code>pagoo</code> applies the the Power-law distribution to fit the pangenome size and the Exponential decay function to fit the core genome size.</p>
<p>Rarefaction curves are computed by first performing permutations with <code>$rarefact()</code>, and then fitting a Power Law to pangenome counts, and an Exponential Decay Law to coregenome counts. The latter two operations are done by using <code>$pg_power_law_fit()</code> and <code>$cg_exp_decay_fit()</code> methods, respectively (see documentation for more details). <code>$gg_curves()</code> combines this methods to facilitate plotting.</p>
<div class="sourceCode" id="cb11"><pre class="downlit">
<span class="kw">p</span><span class="op">$</span><span class="fu">gg_curves</span>()
</pre></div>
<p><img src="Methods_Plots_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<p>You can add points and facet data by category, and add any other customization:</p>
<div class="sourceCode" id="cb12"><pre class="downlit">
<span class="kw">p</span><span class="op">$</span><span class="fu">gg_curves</span>() <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">"Pangenome and Coregenome curves"</span>) <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>() <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span>(<span class="op">~</span><span class="kw">Category</span>, scales = <span class="st">'free_y'</span>) <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>(base_size = <span class="fl">15</span>) <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_color_brewer</a></span>(palette = <span class="st">"Accent"</span>)
</pre></div>
<p><img src="Methods_Plots_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
</div>
<div id="pca-biplot" class="section level2">
<h2 class="hasAnchor">
<a href="#pca-biplot" class="anchor"></a>PCA Biplot</h2>
<p>A biplot for visualizing the first 2 principal components in a PCA is always useful at early stages of analysis to explore possible association of genomes based on gene content. This method uses <code>$pan_pca()</code> method to perform the PCA, and allows you to use organism metadata to colour the points.</p>
<div class="sourceCode" id="cb13"><pre class="downlit">
<span class="kw">p</span><span class="op">$</span><span class="kw">organisms</span>
</pre></div>
<pre><code>## DataFrame with 10 rows and 8 columns
##           org          id      strain      year     country        host
##      &lt;factor&gt; &lt;character&gt; &lt;character&gt; &lt;integer&gt; &lt;character&gt; &lt;character&gt;
## 1  16244_6_6         FR15   2008/170h      2008      France       Human
## 2  16244_6_18        FR27   2012/185h      2012      France       Human
## 3  16244_6_24        FR33    2014/52h      2014      France       Human
## 4  16244_6_31        FR40    2009/56h      2009      France       Human
## 5  17059_2_16         AR1      99/801      1999   Argentina      Bovine
## 6  17059_2_23         AR8      04/875      2004   Argentina      Bovine
## 7  17059_2_27        AR12      06/195      2006   Argentina      Bovine
## 8  17150_1_73         CA1   001A-0374      2005      Canada       Human
## 9  17059_2_11        CA22    ID136207      2014      Canada       Human
## 10 17059_2_42         TW6        1830      2008      Taiwan       Human
##         source   accession
##    &lt;character&gt; &lt;character&gt;
## 1        Feces   ERS672247
## 2        Blood   ERS672259
## 3          CSF   ERS672265
## 4          CSF   ERS672272
## 5      Prepuce   ERS739235
## 6        Fetus   ERS739242
## 7           VM   ERS739246
## 8        Blood   ERS686652
## 9        Blood   ERS739230
## 10       Blood   ERS739261</code></pre>
<p>Since we have metadata asociated to each organism, we will use it to colour the organisms according to the <code>country</code> variable.</p>
<div class="sourceCode" id="cb15"><pre class="downlit">
<span class="kw">p</span><span class="op">$</span><span class="fu">gg_pca</span>(colour = <span class="st">'host'</span>, size = <span class="fl">4</span>) <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>(base_size = <span class="fl">15</span>) <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_color_brewer</a></span>(palette = <span class="st">"Set2"</span>)
</pre></div>
<p><img src="Methods_Plots_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
</div>
</div>
<div id="shiny-app" class="section level1">
<h1 class="hasAnchor">
<a href="#shiny-app" class="anchor"></a>Shiny App</h1>
<p>Last but not least, you can deploy a local <code>shiny</code> app by just one line of code.</p>
<div class="sourceCode" id="cb16"><pre class="downlit">
<span class="kw">p</span><span class="op">$</span><span class="fu">runShinyApp</span>()
</pre></div>
<p>You can explore an online example of pagoo <code>shiny</code> app for a complete set of 69 <em>Campylobacter fetus</em> genomes at the following url: <a href="https://microgenlab.shinyapps.io/pagoo_campylobacter/" class="uri">https://microgenlab.shinyapps.io/pagoo_campylobacter/</a> . This method is currently not intended for very large and complex datasets, as it may render slow. To work with big pangenomes we recommend the use of the R command line, but for tens or few hundred of genomes it works fairly good if you have patience.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Ignacio Ferres, Gregorio Iraola, Institut Pasteur de Montevideo.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
